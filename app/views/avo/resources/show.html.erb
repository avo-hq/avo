<% if params[:frame_name].present? %>
  <turbo-frame id="<%= params[:frame_name] %>">
<% end %>
<div data-model-id="<%= @model.id %>">
  <% @resource.panels.each do |resource_panel| %>
    <% if resource_panel[:in_panel] %>
      <%= panel(title: resource_panel[:name]) do |component| %>
        <% component.with :tools do %>
          <% if resource_panel[:name] == @resource.default_panel_name %>
            <div class="flex justify-end space-x-2">
              <%= render 'actions' %>
              <% back_path = params[:via_resource_name].present? ? resource_path(to_resource_name: params[:via_resource_name], to_resource_id: params[:via_resource_id], keep_query_params: false) : resources_path(@model.class) %>
              <%= a_link back_path do %>
                <%= svg 'media/svgs/arrow-left.svg' %> <%= t('avo.go_back') %>
              <% end %>
              <%= a_link resource_path(@model), color: 'red', variant: 'outlined', method: :delete, data: {confirm: 'Are you sure?'} do %>
                <%= svg 'media/svgs/trash.svg' %> <%= t('avo.delete').capitalize %>
              <% end if @authorization.set_record(@model).authorize_action :destroy, raise_exception: false %>
              <%= a_link edit_resource_path(@model), color: 'indigo' do %>
                <%= svg 'media/svgs/edit.svg' %> <%= t('avo.edit').capitalize %>
              <% end if @authorization.set_record(@model).authorize_action :edit, raise_exception: false %>
            </div>
          <% end %>
        <% end %>

        <% component.with :body do %>
          <% @resource.get_fields(panel: resource_panel[:name]).each_with_index do |field, index| %>
            <%= show_field field, index, @resource %>
          <% end %>
        <% end %>
      <% end %>
    <% else %>
      <% @resource.get_fields(panel: resource_panel[:name]).each_with_index do |field, index| %>
        <%= show_field field, index, @resource %>
      <% end %>
    <% end %>
  <% end %>
</div>
<% if params[:frame_name].present? %>
  </turbo-frame>
<% end %>
