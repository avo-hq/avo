<div data-model-id="<%= @model.id %>">
  <% @resource.panels.each do |resource_panel| %>
    <%= form_with model: @model, url: resource_path(@model), method: :put do |form| %>
      <%= panel do %>
        <% content_for :heading do %>
          <%= resource_panel[:name] %>
        <% end %>

        <% content_for :tools do %>
          <div class="flex justify-end space-x-2">
            <%= a_link resource_path(@model) do %>
              <% # @todo: also go back to via resource %>
              <%= svg 'media/svgs/arrow-left.svg' %> <%= t('avo.cancel').capitalize %>
            <% end %>

            <%= a_button color: 'red', variant: 'outlined', type: :submit do %>
              <%= svg 'media/svgs/save.svg' %> <%= t('avo.save').capitalize %>
            <% end if @authorization.set_record(@model).authorize_action :update, raise_exception: false %>
          </div>
        <% end %>

        <% @resource.get_fields.each_with_index do |field, index| %>
          <%= edit_field field, index, @resource, form unless field.computed %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <div>
    <%#= has many panel %>
  </div>
</div>

<div :resource-id="resourceId">
  <div v-for="panel in panels" :key="panel.name">
    <panel>
      <template #heading>
        {{panel.name}}
      </template>

      <template #tools>
        <div class="flex justify-end space-x-2">
          <resource-actions :resource-name="resourceName" :resource-ids="[resourceId]" :actions="actions" />
          <a-button :to="cancelActionParams">
            <arrow-left-icon class="h-4 mr-1"/> {{ $t('avo.go_back') }}
          </a-button>
          <a-button
            color="red"
            variant="outlined"
            v-if="canDelete"
            @click="openDeleteModal"
          >
            <trash-icon class="text-red-700 h-4 mr-1"/>
            {{ $t('avo.delete') | upperFirst() }}
          </a-button>
          <a-button
            color="indigo"
            :to="{
              name: 'edit',
              params: {
                resourceName: resourceName,
                resourceId: resource.id,
              },
            }"
            v-if="canEdit"
          >
            <edit-icon class="h-4 mr-1" /> {{ $t('avo.edit') | upperFirst() }}
          </a-button>
        </div>
      </template>

      <template #content>
        <loading-overlay v-if="isLoading" />
        <component
          v-for="(field, index) in fieldsForPanel(panel)"
          :key="uniqueKey(field, index)"
          :is="`show-${field.component}`"
          :field="field"
          :index="index"
          :resource-name="resourceName"
          :resource-id="resourceId"
          :field-id="field.id"
          :field-component="field.component"
        />
      </template>
    </panel>

    <component
      v-for="field in hasManyRelations"
      :key="field.id"
      :is="`show-${field.component}`"
      :field="field"
      :resource-name="resourceName"
      :resource-id="resourceId"
      :field-component="field.component"
    />
  </div>
</div>

<%= @resource.inspect %>
