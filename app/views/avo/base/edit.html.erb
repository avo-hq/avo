<div data-model-id="<%= @model.id %>">
  <% @resource.panels.each do |resource_panel| %>
    <%= form_with model: @model, url: resource_path(@model), method: :put do |form| %>
      <%= panel(title: resource_panel[:name]) do |component| %>
        <% component.with :heading do %>
          <%= resource_panel[:name] %>
        <% end %>

        <% component.with :tools do %>
          <div class="flex justify-end space-x-2">
            <%= a_link resource_path(@model) do %>
              <% # @todo: also go back to via resource %>
              <%= svg 'media/svgs/arrow-left.svg' %> <%= t('avo.cancel').capitalize %>
            <% end %>

            <%= a_button color: 'green', variant: 'outlined', type: :submit do %>
              <%= svg 'media/svgs/save.svg' %> <%= t('avo.save').capitalize %>
            <% end if @authorization.set_record(@model).authorize_action :update, raise_exception: false %>
          </div>
        <% end %>

        <% component.with :body do %>
          <% @resource.get_fields.each_with_index do |field, index| %>
            <%= edit_field field, index, @resource, form unless field.computed %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
</div>
