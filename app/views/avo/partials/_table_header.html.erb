<thead
  data-component-name="avo/partials/table_header"
  class="bg-white border-b border-gray-200 pb-1">
  <% if @resource.record_selector %>
    <th class="rounded-lg" data-control="item-select-th">
      <%== item_select_all_input %>
    </th>
  <% end %>
  <% if Avo.configuration.resource_controls_on_the_left? %>
    <th class="w-24" data-control="resource-controls-th">
      <!-- Item controls cell -->
    </th>
  <% end %>
  <% fields.each_with_index do |field, index|  %>
    <%
      if params[:sort_by] == field.id.to_s
        if params[:sort_direction] == 'asc'
          sort_by = nil
        else
          sort_by = field.id
        end

        if sort_by.present?
          case params[:sort_direction]
            when nil
              sort_direction = 'desc'
            when 'desc'
              sort_direction = 'asc'
            when 'asc'
              sort_direction = nil
            end
        else
          sort_direction = nil
        end
      else
        sort_by = field.id
        sort_direction = 'desc'
      end
      classes = "text-gray-500 tracking-tight leading-tight text-xs font-semibold"
    %>
    <%= content_tag :th,
      class: "text-left uppercase px-3 py-3 whitespace-nowrap rounded-l",
      data: {
        control: "resource-field-th",
        controller: "toggle",
        table_header_field_id: field.id,
        table_header_field_type: field.type,
      } do %>
      <% if field.sortable %>
        <%= link_to params.permit!.merge(sort_by: sort_by, sort_direction: sort_direction), class: "flex items-center cursor-pointer #{classes}", 'data-turbo-frame': params[:turbo_frame] do %>
          <%= field.table_header_label %>
          <%= render partial: 'avo/partials/sortable_component', locals: {field: field} %>
        <% end %>
      <% elsif field.summarizable %>
        <div class="flex items-center space-between w-full cursor-pointer <%= classes %>" data-action="click->toggle#togglePanel">
          <%= field.table_header_label %>
          <%= helpers.svg 'heroicons/solid/chart-bar', class: 'h-3 ml-1' %>
        </div>
        <div
            class="absolute grid grid-cols-12 inset-auto bg-white w-full sm:w-auto sm:w-[350px] mt-2 p-4 z-40 shadow-modal rounded overflow-hidden hidden"
            data-toggle-target="panel"
          >
          <ul class="col-span-5">
            <% field.values_summary.each_with_index do |(key, value), index| %>
              <li class="font-normal normal-case grid grid-cols-6 gap-3">
                <div class="col-span-5 truncate">
                  <span class="<%= "inline-block w-[0.75rem] h-[0.75rem] rounded-full bg-chart-color-#{index}" %>"></span>
                  <%= key %>
                </div>
                <div class="col-span-1">
                  <%= value %>
                </div>
              </li>
            <% end %>
          </ul>
          <div class="col-start-7 col-span-6">
            <%= pie_chart field.values_summary, legend: false, height: "100%", colors: Avo.configuration.branding.chart_colors %>
          </div>
        </div>
      <% else %>
        <div class="block w-full <%= classes %>">
          <%= field.table_header_label %>
        </div>
      <% end %>
    <% end %>
  <% end %>
  <% if Avo.configuration.resource_controls_on_the_right? %>
    <th class="w-24" data-control="resource-controls-th">
      <!-- Item controls cell -->
    </th>
  <% end %>
</thead>
