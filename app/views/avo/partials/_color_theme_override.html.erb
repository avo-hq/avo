<script>
  // On page load, apply color scheme and theme from cookies to avoid FOUC
  (function() {
    // Read cookies
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }

    const colorScheme = getCookie('color_scheme') || 'auto';
    const theme = getCookie('theme') || 'brand';

    // Apply color scheme
    const isDark = colorScheme === 'dark' || (colorScheme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    // Apply scheme selection classes
    document.documentElement.classList.remove('scheme-light', 'scheme-dark', 'scheme-auto');
    if (colorScheme === 'light') {
      document.documentElement.classList.add('scheme-light');
    } else if (colorScheme === 'dark') {
      document.documentElement.classList.add('scheme-dark');
    } else {
      document.documentElement.classList.add('scheme-auto');
    }

    // Apply theme class
    document.documentElement.classList.remove('theme-slate', 'theme-stone');
    if (theme && theme !== 'brand') {
      document.documentElement.classList.add('theme-' + theme);
    }
  })();
</script>
