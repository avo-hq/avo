#!/bin/bash -e

# Check to see if the user intentionally disabled Docker or if it's already running
if [[ -z "$AVO_DISABLE_DOCKER" ]] && [[ -z `docker-compose ps | awk '$4 == "Up" {print $1}' | grep avo_db_1` ]]; then
  use_docker=true
fi;

if [[ $use_docker ]]; then
  docker-compose up -d
fi

if [[ $WEBPACK ]]; then
  bin/webpack
fi;

bundle exec rspec "$@"

if [[ $use_docker ]]; then
  docker-compose stop
fi