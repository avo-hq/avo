#!/bin/bash -e

if [[ -z "$DISABLE_DOCKER" ]] && [[ -z `docker-compose ps | awk '$4 == "Up" {print $1}' | grep avo_db_1` ]]; then
  use_docker=true
fi;

if [[ $use_docker ]]; then
  docker-compose up -d
fi

bin/webpack
bundle exec rspec ./spec --tag type:system

if [[ $use_docker ]]; then
  docker-compose stop
fi